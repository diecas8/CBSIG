<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geoportal Predios PFNM, Casanare</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        #map {
            flex-grow: 1;
        }
        #sidebar {
            width: 300px;
            padding: 10px;
            background-color: #f7f7f7;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            text-align: center;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="sidebar">
        <img src="CBS.png" alt="Logo" style="width: 100%; margin-bottom: 10px;">
        <h3>Predios cadenas productivas Copaiba y Meliponas</h3>
        <p>Ingrese Código de Finca:</p>
        <input type="text" id="searchField" placeholder="Código de Finca" style="width: 90%; margin-bottom: 10px;">
        <p id="status">Estado: Listo para buscar</p>
    </div>

    <script>
        // Inicializar el mapa
        const map = L.map('map').setView([5.0, -72.0], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Variables para capas
        let geoJsonLayer, fincaLayer, rutasLayer;

        // Función para cargar capa de usos
        function cargarCapaUsos() {
            fetch('https://diecas8.github.io/CGSI/usos.geojson')
                .then(response => response.json())
                .then(data => {
                    geoJsonLayer = L.geoJSON(data, {
                        style: { color: "#FF5733", weight: 1, fillOpacity: 0.5 },
                        onEachFeature: (feature, layer) => {
                            layer.bindPopup(`<b>Cultivo:</b> ${feature.properties.cultivo}<br><b>Área:</b> ${feature.properties.has} ha`);
                        }
                    }).addTo(map);
                    document.getElementById('status').textContent = 'Capa de usos cargada';
                })
                .catch(error => {
                    console.error("Error al cargar usos.geojson:", error);
                    document.getElementById('status').textContent = 'Error al cargar capa de usos';
                });
        }

        // Función para cargar capa de fincas
        function cargarCapaFincas() {
            fetch('https://diecas8.github.io/CGSI/fincasssss.geojson')
                .then(response => response.json())
                .then(data => {
                    fincaLayer = L.geoJSON(data, {
                        style: { color: "#8B4513", weight: 1.5, fillOpacity: 0 }
                    }).addTo(map);
                    document.getElementById('status').textContent = 'Capa de fincas cargada';
                })
                .catch(error => {
                    console.error("Error al cargar fincasssss.geojson:", error);
                    document.getElementById('status').textContent = 'Error al cargar capa de fincas';
                });
        }

        // Función para cargar capa de rutas
        function cargarCapaRutas() {
            fetch('https://diecas8.github.io/CGSI/Rutas.geojson')
                .then(response => response.json())
                .then(data => {
                    rutasLayer = L.geoJSON(data, {
                        style: { color: "#FF5733", weight: 2, dashArray: '5,5' }
                    }).addTo(map);
                    document.getElementById('status').textContent = 'Capa de rutas cargada';
                })
                .catch(error => {
                    console.error("Error al cargar Rutas.geojson:", error);
                    document.getElementById('status').textContent = 'Error al cargar capa de rutas';
                });
        }

        // Llamada a las funciones para cargar las capas
        cargarCapaUsos();
        cargarCapaFincas();
        cargarCapaRutas();

        // Función para buscar finca por código
        document.getElementById("searchField").addEventListener("keydown", function(event) {
            if (event.key === "Enter" && geoJsonLayer) {
                const codigoFinca = this.value.toUpperCase();
                let encontrada = false;
                geoJsonLayer.eachLayer(layer => {
                    if (layer.feature.properties.cod_finca === codigoFinca) {
                        map.fitBounds(layer.getBounds());
                        layer.openPopup();
                        encontrada = true;
                    }
                });
                if (!encontrada) {
                    alert("Finca no encontrada");
                }
            }
        });
    </script>
</body>
</html>


