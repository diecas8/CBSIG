<!DOCTYPE html>
<html>
<head>
  <title>Mapa Interactivo con Leaflet.Draw y Turf.js</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@latest/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-draw@latest/dist/leaflet.draw.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@latest/turf.min.js"></script>
</head>
<body>
  <div id="map"></div>

  <script>
    // Coordenadas iniciales para centrar el mapa en Colombia
    var latlng = [-4.0522, -72.5000]; // Ajusta según la región específica

    // Crear el mapa
    var map = L.map('map').setView(latlng, 6);

    // Agregar capa de tiles (puedes cambiar esto por otra fuente)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Crear un grupo de capas para almacenar las entidades dibujadas
    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    // Agregar control de dibujo
    var drawControl = new L.Control.Draw({
        draw: {
            polygon: true,
            polyline: true,
            marker: true
        },
        edit: {
            featureGroup: drawnItems
        }
    }).addTo(map);

    // Evento para cuando se crea una nueva entidad
    map.on(L.Draw.Event.CREATED, function (event) {
        var layer = event.layer;
        drawnItems.addLayer(layer);

        // Si es un polígono, calculamos el área y agregamos un popup con atributos
        if (layer instanceof L.Polygon) {
            var area = turf.area(layer.toGeoJSON());
            layer.bindPopup("Área: " + area + " m²" + "<br>" + 
                            "Otros atributos: " + // Aquí agregas tus atributos
                            "<br> Ubicación GPS: " + layer.getBounds().getCenter());
            layer.openPopup();
        }
    });

    // Obtener la ubicación del GPS (requiere permisos del usuario)
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      } else {
        console.log("Geolocation is not supported by this browser.");
      }
    }

    function showPosition(position) {
      var marker = L.marker([position.coords.latitude, position.coords.longitude]).addTo(map);
      marker.bindPopup("Tu ubicación").openPopup();
    }

    // Llamar a la función para obtener la ubicación
    getLocation();
  </script>
</body>
</html>
